<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>响应式24x24网格看板</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        color: #2c3e50;
      }

      h1 {
        margin: 15px 0;
        text-align: center;
        color: #3498db;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      .description {
        text-align: center;
        margin-bottom: 20px;
        max-width: 600px;
        line-height: 1.5;
        color: #34495e;
      }

      .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 100%;
        max-width: 1200px;
      }

      @media (min-width: 992px) {
        .container {
          flex-direction: row;
        }

        .components-panel {
          width: 200px;
          flex-shrink: 0;
        }
      }

      .components-panel {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .components-panel h2 {
        margin-bottom: 15px;
        color: #3498db;
        font-size: 1.2rem;
        text-align: center;
      }

      .component {
        background: #3498db;
        color: white;
        padding: 12px;
        margin: 10px 0;
        border-radius: 6px;
        cursor: grab;
        text-align: center;
        transition: all 0.2s ease;
        user-select: none;
      }

      .component:hover {
        background: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
      }

      .kanban-container {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        overflow: auto;
        flex: 1;
      }

      .kanban-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .grid-size {
        font-weight: bold;
        color: #7f8c8d;
      }

      .kanban-wrapper {
        position: relative;
        width: 100%;
        padding-bottom: 100%;
        /* 保持1:1宽高比 */
      }

      .kanban {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          linear-gradient(to right, #eee 1px, transparent 1px), linear-gradient(to bottom, #eee 1px, transparent 1px);
        background-size: calc(100% / 24) calc(100% / 24);
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: hidden;
      }

      .grid-item {
        position: absolute;
        background: rgba(52, 152, 219, 0.8);
        border: 2px solid #2980b9;
        border-radius: 5px;
        padding: 10px;
        color: white;
        cursor: move;
        user-select: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease;
        z-index: 1;
      }

      .grid-item:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 2;
      }

      .grid-item.overlapping {
        border: 2px dashed #e74c3c;
        background: rgba(231, 76, 60, 0.3);
      }

      .grid-item.resizing {
        box-shadow: 0 0 0 2px #e74c3c;
        z-index: 3;
      }

      .grid-size-info {
        font-size: 12px;
        margin-top: 5px;
        background: rgba(0, 0, 0, 0.2);
        padding: 2px 5px;
        border-radius: 3px;
      }

      .resize-handle {
        position: absolute;
        width: 12px;
        height: 12px;
        background: #e74c3c;
        border-radius: 50%;
        right: -6px;
        bottom: -6px;
        cursor: nwse-resize;
        box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
        z-index: 4;
      }

      .instructions {
        margin-top: 20px;
        background: white;
        border-radius: 10px;
        padding: 15px;
        max-width: 1200px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .instructions h3 {
        color: #3498db;
        margin-bottom: 10px;
      }

      .instructions ul {
        padding-left: 20px;
        line-height: 1.6;
      }

      .instructions li {
        margin-bottom: 8px;
      }

      .status {
        margin-top: 10px;
        padding: 8px 12px;
        border-radius: 4px;
        background: #f8f9fa;
        font-size: 14px;
        min-height: 36px;
      }

      .status.overlap-warning {
        background: #ffeaa7;
        color: #d35400;
      }
    </style>
  </head>

  <body>
    <h1>响应式24×24网格看板</h1>
    <p class="description">组件使用1-24网格单位定义大小，支持响应式布局，防重叠功能。</p>

    <div class="container">
      <div class="components-panel">
        <h2>组件库</h2>
        <div class="component" data-type="chart" data-width="4" data-height="3" draggable="true">图表 (4×3)</div>
        <div class="component" data-type="table" data-width="6" data-height="4" draggable="true">表格 (6×4)</div>
        <div class="component" data-type="metric" data-width="2" data-height="2" draggable="true">指标 (2×2)</div>
        <div class="component" data-type="image" data-width="3" data-height="3" draggable="true">图片 (3×3)</div>
        <div class="component" data-type="text" data-width="4" data-height="2" draggable="true">文本 (4×2)</div>
      </div>

      <div class="kanban-container">
        <div class="kanban-header">
          <h2>看板面板</h2>
          <div class="grid-size">网格: 24×24 单位</div>
        </div>
        <div class="status" id="status">准备就绪。从左侧拖拽组件到看板上。</div>
        <div class="kanban-wrapper">
          <div class="kanban" id="kanban"></div>
        </div>
      </div>
    </div>

    <div class="instructions">
      <h3>使用说明</h3>
      <ul>
        <li>从左侧拖拽组件到看板上，组件使用网格单位(1-24)定义大小</li>
        <li>拖动组件中部可以移动组件位置</li>
        <li>拖动组件右下角的手柄可以调整组件大小</li>
        <li>组件会自动对齐到网格</li>
        <li>组件在移动和调整大时会自动避免与其他组件重叠</li>
        <li>红色虚线边框表示当前位置会导致重叠，无法放置</li>
        <li>看板是响应式的，会根据容器大小自动调整</li>
      </ul>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const kanban = document.getElementById('kanban')
        const status = document.getElementById('status')
        const components = document.querySelectorAll('.component')
        let activeItem = null
        let isDragging = false
        let isResizing = false
        let startX, startY
        let startWidth, startHeight
        let startLeft, startTop

        // 网格单位大小（百分比）
        const GRID_UNIT = 100 / 24 // 每个网格单位占看板宽度的百分比

        // 创建网格背景
        function createGrid() {
          // CSS渐变已经创建了网格，这里只需要添加网格坐标
          for (let x = 0; x <= 24; x++) {
            const xLabel = document.createElement('div')
            xLabel.style.position = 'absolute'
            xLabel.style.left = `calc(${x} * ${GRID_UNIT}%)`
            xLabel.style.top = '-20px'
            xLabel.style.fontSize = '10px'
            xLabel.style.color = '#95a5a6'
            xLabel.textContent = x
            kanban.appendChild(xLabel)
          }

          for (let y = 0; y <= 24; y++) {
            const yLabel = document.createElement('div')
            yLabel.style.position = 'absolute'
            yLabel.style.left = '-25px'
            yLabel.style.top = `calc(${y} * ${GRID_UNIT}%)`
            yLabel.style.fontSize = '10px'
            yLabel.style.color = '#95a5a6'
            yLabel.textContent = y
            kanban.appendChild(yLabel)
          }
        }

        createGrid()

        // 为组件添加拖拽事件
        components.forEach((component) => {
          component.addEventListener('dragstart', function (e) {
            const type = component.dataset.type
            const width = parseInt(component.dataset.width)
            const height = parseInt(component.dataset.height)

            e.dataTransfer.setData(
              'text/plain',
              JSON.stringify({
                type: type,
                width: width,
                height: height,
              }),

              status.textContent = `正在拖拽: ${component.textContent}`
            })
        })

        // 看板放置区域事件
        kanban.addEventListener('dragover', function (e) {
          e.preventDefault()
          kanban.style.backgroundColor = '#f8f9fa'
        })

        kanban.addEventListener('dragleave', function () {
          kanban.style.backgroundColor = ''
        })

        kanban.addEventListener('drop', function (e) {
          e.preventDefault()
          kanban.style.backgroundColor = ''

          const data = JSON.parse(e.dataTransfer.getData('text/plain'))
          const rect = kanban.getBoundingClientRect()

          // 计算放置位置（对齐到网格）
          const xPercent = ((e.clientX - rect.left) / rect.width) * 100
          const yPercent = ((e.clientY - rect.top) / rect.height) * 100

          const xGrid = Math.floor(xPercent / GRID_UNIT)
          const yGrid = Math.floor(yPercent / GRID_UNIT)

          const xPos = xGrid * GRID_UNIT
          const yPos = yGrid * GRID_UNIT

          // 检查是否与现有组件重叠
          if (!isOverlapping(xGrid, yGrid, data.width, data.height, null)) {
            // 创建新组件
            createComponent(data.type, xGrid, yGrid, data.width, data.height)
            status.textContent = `已添加: ${data.type}组件 (${data.width}×${data.height})`
          } else {
            status.textContent = '无法放置组件: 与现有组件重叠'
            status.classList.add('overlap-warning')
            setTimeout(() => {
              status.classList.remove('overlap-warning')
              status.textContent = '准备就绪'
            }, 2000)
          }
        })

        // 检查是否与现有组件重叠（使用网格单位）
        function isOverlapping(x, y, width, height, excludeItem) {
          const items = kanban.querySelectorAll('.grid-item')

          const newRect = {
            left: x,
            top: y,
            right: x + width,
            bottom: y + height,
          }

          for (let i = 0; i < items.length; i++) {
            const item = items[i]

            // 排除自身
            if (excludeItem && item === excludeItem) continue

            const itemX = parseInt(item.dataset.x)
            const itemY = parseInt(item.dataset.y)
            const itemWidth = parseInt(item.dataset.width)
            const itemHeight = parseInt(item.dataset.height)

            const itemRect = {
              left: itemX,
              top: itemY,
              right: itemX + itemWidth,
              bottom: itemY + itemHeight,
            }

            // 检查矩形是否重叠
            if (
              newRect.left < itemRect.right &&
              newRect.right > itemRect.left &&
              newRect.top < itemRect.bottom &&
              newRect.bottom > itemRect.top
            ) {
              return true
            }
          }

          return false
        }

        // 创建看板组件
        function createComponent(type, x, y, width, height) {
          const component = document.createElement('div')
          component.className = 'grid-item'
          component.dataset.x = x
          component.dataset.y = y
          component.dataset.width = width
          component.dataset.height = height

          // 设置位置和大小（使用百分比）
          component.style.left = `calc(${x} * ${GRID_UNIT}%)`
          component.style.top = `calc(${y} * ${GRID_UNIT}%)`
          component.style.width = `calc(${width} * ${GRID_UNIT}% - 2px)`
          component.style.height = `calc(${height} * ${GRID_UNIT}% - 2px)`

          // 根据类型设置内容
          let title = ''
          switch (type) {
            case 'chart':
              title = '数据分析图表'
              component.style.background = 'linear-gradient(135deg, #3498db, #2c3e50)'
              break
            case 'table':
              title = '数据表格'
              component.style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)'
              break
            case 'metric':
              title = '关键指标'
              component.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)'
              break
            case 'image':
              title = '图片展示'
              component.style.background = 'linear-gradient(135deg, #9b59b6, #8e44ad)'
              break
            case 'text':
              title = '文本组件'
              component.style.background = 'linear-gradient(135deg, #f39c12, #d35400)'
              break
          }

          component.innerHTML = `
                      <div>${title}</div>
                      <div class="grid-size-info">${width}×${height}</div>
                  `

          // 添加调整大小手柄
          const resizeHandle = document.createElement('div')
          resizeHandle.className = 'resize-handle'
          component.appendChild(resizeHandle)

          // 添加到看板
          kanban.appendChild(component)

          // 添加事件监听
          addDragAndResizeListeners(component)

          return component
        }

        // 添加拖拽和调整大小事件
        function addDragAndResizeListeners(item) {
          const resizeHandle = item.querySelector('.resize-handle')

          // 鼠标按下事件 - 移动
          item.addEventListener('mousedown', function (e) {
            if (e.target === resizeHandle) return // 调整大小手柄有自己的事件

            activeItem = item
            isDragging = true

            const rect = item.getBoundingClientRect()
            startX = e.clientX
            startY = e.clientY
            startLeft = parseInt(item.dataset.x)
            startTop = parseInt(item.dataset.y)

            item.style.zIndex = 1000
            e.preventDefault()
          })

          // 鼠标按下事件 - 调整大小
          resizeHandle.addEventListener('mousedown', function (e) {
            activeItem = item
            isResizing = true

            const rect = item.getBoundingClientRect()
            startX = e.clientX
            startY = e.clientY
            startWidth = parseInt(item.dataset.width)
            startHeight = parseInt(item.dataset.height)
            startLeft = parseInt(item.dataset.x)
            startTop = parseInt(item.dataset.y)

            item.classList.add('resizing')
            e.stopPropagation()
            e.preventDefault()
          })

          // 鼠标移动事件
          document.addEventListener('mousemove', function (e) {
            if (!activeItem) return

            const kanbanRect = kanban.getBoundingClientRect()
            const gridSizePx = kanbanRect.width / 24

            if (isDragging) {
              // 计算新位置（网格单位）
              const deltaX = (e.clientX - startX) / gridSizePx
              const deltaY = (e.clientY - startY) / gridSizePx

              let newX = Math.round(startLeft + deltaX)
              let newY = Math.round(startTop + deltaY)

              // 边界检查
              newX = Math.max(0, Math.min(24 - parseInt(activeItem.dataset.width), newX))
              newY = Math.max(0, Math.min(24 - parseInt(activeItem.dataset.height), newY))

              !isOverlapping(
                newX,
                newY,
                parseInt(activeItem.dataset.width),
                parseInt(activeItem.dataset.height),
                activeItem,
              )
                ) {
            // 应用新位置
            activeItem.dataset.x = newX
            activeItem.dataset.y = newY
            activeItem.style.left = `calc(${newX} * ${GRID_UNIT}%)`
            activeItem.style.top = `calc(${newY} * ${GRID_UNIT}%)`
            activeItem.classList.remove('overlapping')
            status.textContent = `位置: (${newX}, ${newY}), 大小: (${activeItem.dataset.width}×${activeItem.dataset.height})`
          } else {
            // 显示重叠警告
            activeItem.classList.add('overlapping')
            status.textContent = '无法移动: 与现有组件重叠'
            status.classList.add('overlap-warning')
          }
        } else if (isResizing) {
          // 计算新尺寸（网格单位）
          const deltaX = (e.clientX - startX) / gridSizePx
          const deltaY = (e.clientY - startY) / gridSizePx

          let newWidth = Math.round(startWidth + deltaX)
          let newHeight = Math.round(startHeight + deltaY)

          // 最小尺寸和边界检查
          newWidth = Math.max(1, Math.min(24 - startLeft, newWidth))
          newHeight = Math.max(1, Math.min(24 - startTop, newHeight))

          // 检查是否重叠
          if (!isOverlapping(startLeft, startTop, newWidth, newHeight, activeItem)) {
            // 应用新尺寸
            activeItem.dataset.width = newWidth
            activeItem.dataset.height = newHeight
            activeItem.style.width = `calc(${newWidth} * ${GRID_UNIT}% - 2px)`
            activeItem.style.height = `calc(${newHeight} * ${GRID_UNIT}% - 2px)`
            activeItem.querySelector('.grid-size-info').textContent = `${newWidth}×${newHeight}`
            activeItem.classList.remove('overlapping')
            status.textContent = `位置: (${startLeft}, ${startTop}), 大小: (${newWidth}×${newHeight})`
          } else {
            // 显示重叠警告
            activeItem.classList.add('overlapping')
            status.textContent = '无法调整大小: 与现有组件重叠'
            status.classList.add('overlap-warning')
          }
        }
      })

      // 鼠标释放事件
      document.addEventListener('mouseup', function () {
        if (activeItem) {
          activeItem.style.zIndex = ''
          activeItem.classList.remove('resizing')

          if (activeItem.classList.contains('overlapping')) {
            // 恢复原始位置或大小
            if (isDragging) {
              activeItem.dataset.x = startLeft
              activeItem.dataset.y = startTop
              activeItem.style.left = `calc(${startLeft} * ${GRID_UNIT}%)`
              activeItem.style.top = `calc(${startTop} * ${GRID_UNIT}%)`
            } else if (isResizing) {
              activeItem.dataset.width = startWidth
              activeItem.dataset.height = startHeight
              activeItem.style.width = `calc(${startWidth} * ${GRID_UNIT}% - 2px)`
              activeItem.style.height = `calc(${startHeight} * ${GRID_UNIT}% - 2px)`
              activeItem.querySelector('.grid-size-info').textContent = `${startWidth}×${startHeight}`
            }
            activeItem.classList.remove('overlapping')

            setTimeout(() => {
              status.classList.remove('overlap-warning')
              status.textContent = '操作已取消: 重叠检测'
            }, 1000)
          } else {
            status.textContent = '操作完成'
          }

          activeItem = null
        }
        isDragging = false
        isResizing = false
      })
          }

      // 添加一些示例组件
      createComponent('chart', 1, 1, 4, 3)
      createComponent('metric', 6, 2, 2, 2)
      createComponent('table', 2, 7, 6, 4)

      // 窗口大小变化时重新计算位置
      window.addEventListener('resize', function () {
        // 所有组件的位置和大小已经是基于百分比的，不需要额外处理
        // 这里只是触发重绘
        kanban.style.display = 'none'
        kanban.offsetHeight // 触发重绘
        kanban.style.display = 'block'
      })
        })
    </script>
  </body>
</html>
